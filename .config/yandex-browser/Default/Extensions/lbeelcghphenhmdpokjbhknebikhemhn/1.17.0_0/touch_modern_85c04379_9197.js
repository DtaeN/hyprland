"use strict";(self.webpackChunkv4fire_1=self.webpackChunkv4fire_1||[]).push([[9197],{9197:(e,s,r)=>{r.r(s),r.d(s,{$$:()=>l,asyncGroup:()=>g,default:()=>CbProgress,progressRequestErrorEvent:()=>p});var t=r(31635),o=r(2168);var a=r(88202);let n=class Progress extends a.Kx{constructor(){super(...arguments),this.baseURL="/progress"}};n.request=a.Kx.request({okStatuses:Any(o.RM.toArray().concat(304))}),n.decoders={get:[function(e,s,r){var t,o;const a=null===(t=s.opts.meta.provider)||void 0===t?void 0:t.providerName,n=null===(o=s.opts.meta.provider)||void 0===o?void 0:o.params.remoteState;if(null==n)throw new Error(`Remote state in ${a} dataprovider is missing!`);if(r.ok){const s=n.sharedCache.getCache("progress:actions"),t=n.sharedCache.getCache("progress:response");if(304!==r.status){const o=r.headers.get("etag");return null!=o&&(t.set("etag",o),t.set("body",Object.fastClone(e))),s.clear(),e}const o=t.get("body");if(null!=o)return e=Object.fastClone(o),Object.keys(e).forEach((r=>{const t=s.get(r);null!=e&&t&&(e[r]=t)})),e}return e}]},n.encoders={get:[function(e,s){var r,t;const o=(null===(r=s.opts.meta.provider)||void 0===r?void 0:r.params.remoteState).sharedCache.getCache("progress:response");return null!=(null===(t=s.opts)||void 0===t?void 0:t.headers)&&o.has("etag")&&(s.opts.headers["If-None-Match"]=o.get("etag")),e}]},n=(0,t.Cg)([(0,a.Mn)("cb")],n);const i=n;var c=r(66207),u=r(8499),h=r(73756);const g="progress-request-async-group",l=(0,h.A)(),p="cbProgressRequestError";class CbProgress extends u.A{constructor(e){super(e);const{proxy:s,unwatch:r,set:t}=(0,c.Ay)({value:void 0});this.progressProxy=s,this.setProgress=t,this.ctx.async.worker(r),this.provider=e.createDataProviderInstance(i),this.isAuth&&this.requestProgress(),this.component.watch("remoteState.isAuth",{group:g,label:l.progressRequestAuthWatcher},(()=>{this.isAuth?this.requestProgress():this.progress=void 0}))}static getInstance(e){const s=e.remoteState;return null==s[l.cbProgressInstance]&&(s[l.cbProgressInstance]=new CbProgress(e)),s[l.cbProgressInstance]}set progress(e){this.setProgress("value",e)}get progress(){return this.progressProxy.value}setCampaignProgress(e,s){if(null==this.progress)return;const r={...this.progress};r[e]=s,this.progress=r}reload(){return this.requestProgress()}watch(e,s,r,t=!0){const o={...r,immediate:!0};t&&void 0!==this.progress&&s(this.progress,void 0);e.watch({ctx:this.progressProxy,path:"value"},((e,r)=>{s(null==e?void 0:e.value,null==r?void 0:r.value)}),o)}watchProgressRequestError(e){const s=this.localEmitter.on(p,e,{group:g});return()=>this.localEmitter.off(s)}async requestProgress(){let e;try{e=await this.async.request(this.provider.get().data,{group:g,label:l.progressRequest,join:"replace"})}catch(t){return void this.onProgressRequestError(t)}const s=this.progress,r=e??void 0;Object.fastCompare(r,s)||(this.progress=r)}get isAuth(){return Boolean(this.component.remoteState.isAuth)}onProgressRequestError(e){this.localEmitter.emit(p,e,this.reload.bind(this))}}}}]);